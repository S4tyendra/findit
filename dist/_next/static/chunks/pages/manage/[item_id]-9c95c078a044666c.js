(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[999],{4376:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage/[item_id]",function(){return a(6361)}])},6361:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>C});var s=a(7876),l=a(4232),n=a(9099),r=a(9650),i=a(9081),o=a(6591),c=a(2774),d=a(9983),u=a(3397),m=a(8069),x=a(5627),h=a(7040),g=a(2450),j=a(8488);function f(e){let{...t}=e;return(0,s.jsx)(g.bL,{"data-slot":"alert-dialog",...t})}function p(e){let{...t}=e;return(0,s.jsx)(g.l9,{"data-slot":"alert-dialog-trigger",...t})}function v(e){let{...t}=e;return(0,s.jsx)(g.ZL,{"data-slot":"alert-dialog-portal",...t})}function y(e){let{className:t,...a}=e;return(0,s.jsx)(g.hJ,{"data-slot":"alert-dialog-overlay",className:(0,j.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function N(e){let{className:t,...a}=e;return(0,s.jsxs)(v,{children:[(0,s.jsx)(y,{}),(0,s.jsx)(g.UC,{"data-slot":"alert-dialog-content",className:(0,j.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...a})]})}function _(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-dialog-header",className:(0,j.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function b(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-dialog-footer",className:(0,j.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function k(e){let{className:t,...a}=e;return(0,s.jsx)(g.hE,{"data-slot":"alert-dialog-title",className:(0,j.cn)("text-lg font-semibold",t),...a})}function w(e){let{className:t,...a}=e;return(0,s.jsx)(g.VY,{"data-slot":"alert-dialog-description",className:(0,j.cn)("text-muted-foreground text-sm",t),...a})}function S(e){let{className:t,...a}=e;return(0,s.jsx)(g.rc,{className:(0,j.cn)((0,d.r)(),t),...a})}function L(e){let{className:t,...a}=e;return(0,s.jsx)(g.ZD,{className:(0,j.cn)((0,d.r)({variant:"outline"}),t),...a})}let E="manage_token_",C=()=>{let e=(0,n.useRouter)(),{item_id:t}=e.query,[a,g]=(0,l.useState)(null),[j,v]=(0,l.useState)(!0),[y,C]=(0,l.useState)(!1),[D,F]=(0,l.useState)(!1),[I,T]=(0,l.useState)(null),[q,R]=(0,l.useState)(null),[A,J]=(0,l.useState)(null),[z,O]=(0,l.useState)(!1),[X,Z]=(0,l.useState)(""),[P,$]=(0,l.useState)(""),[B,M]=(0,l.useState)(""),[U,V]=(0,l.useState)({country:"",state:"",city:""}),W=(0,l.useCallback)(async(t,a)=>{v(!0),T(null);try{let s=await (0,r.Yh)(t,a);if(g(s),Z(s.description||""),$(s.date_lost?s.date_lost.substring(0,10):""),M(s.product_link||""),V({country:s.country||"",state:s.state||"",city:s.city||""}),e.query.token===a)try{localStorage.setItem("".concat(E).concat(t),a),console.log("Stored/refreshed management token for item ".concat(t))}catch(e){console.error("Failed to store management token in localStorage:",e)}}catch(s){if(console.error("Error fetching item for management:",s),T(s.message||"Failed to load item details."),g(null),!e.query.token&&a){try{localStorage.removeItem("".concat(E).concat(t))}catch(e){}T("Invalid or expired token. Please use the link from your email again.")}}finally{v(!1)}},[e.query.token]);(0,l.useEffect)(()=>{if(e.isReady&&t){let a=e.query.token;if(!a)try{a=localStorage.getItem("".concat(E).concat(t))}catch(e){console.error("Failed to read token from localStorage:",e)}a?(J(a),W(t,a)):(T("Management token is missing."),v(!1))}else!t&&e.isReady&&v(!1)},[e.isReady,t,W]);let Y=async e=>{e.preventDefault(),C(!0),R(null);let s={};if(X!==(null==a?void 0:a.description)&&(s.description=X),P!==((null==a?void 0:a.date_lost)?a.date_lost.substring(0,10):""))try{s.date_lost=new Date(P).toISOString()}catch(e){R("Invalid Date Lost format."),C(!1);return}if(B!==((null==a?void 0:a.product_link)||"")&&(s.product_link=B||null),U.country!==((null==a?void 0:a.country)||"")&&(s.country=U.country||null),U.state!==((null==a?void 0:a.state)||"")&&(s.state=U.state||null),U.city!==((null==a?void 0:a.city)||"")&&(s.city=U.city||null),0===Object.keys(s).length){R("No changes detected."),C(!1),O(!1);return}try{let e=await (0,r.fk)(t,A,s);g(e),O(!1)}catch(e){console.error("Update failed:",e),R(e.message||"Failed to save changes.")}finally{C(!1)}},G=async()=>{F(!0),T(null);try{await (0,r.LD)(t,A);try{localStorage.removeItem("".concat(E).concat(t))}catch(e){}e.push("/?deleted=true")}catch(e){console.error("Delete failed:",e),T(e.message||"Failed to delete item."),F(!1)}},H=e=>{if(!e)return"N/A";try{return new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})}catch(t){return e}};return j?(0,s.jsxs)("div",{className:"container mx-auto p-4 max-w-2xl",children:[" ",(0,s.jsxs)(i.Zp,{children:[" ",(0,s.jsxs)(i.aR,{children:[" ",(0,s.jsx)(c.E,{className:"h-6 w-3/4"})," ",(0,s.jsx)(c.E,{className:"h-4 w-1/2 mt-1"})," "]})," ",(0,s.jsxs)(i.Wu,{className:"space-y-4",children:[" ",(0,s.jsx)(c.E,{className:"h-4 w-full"})," ",(0,s.jsx)(c.E,{className:"h-4 w-full"})," ",(0,s.jsx)(c.E,{className:"h-4 w-2/3"})," ",(0,s.jsx)(c.E,{className:"h-20 w-full"})," "]})," "]})," "]}):I&&!z?(0,s.jsxs)("div",{className:"container mx-auto p-4 max-w-2xl",children:[" ",(0,s.jsxs)(o.Fc,{variant:"destructive",children:[" ",(0,s.jsx)(o.XL,{children:"Error"})," ",(0,s.jsx)(o.TN,{children:I})," "]})," "]}):a?(0,s.jsx)("div",{className:"container mx-auto p-4 max-w-2xl",children:(0,s.jsxs)("form",{onSubmit:Y,children:[" ",(0,s.jsxs)(i.Zp,{children:[(0,s.jsx)(i.aR,{children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.ZB,{children:z?"Edit Lost Item":"Manage Lost Item"}),(0,s.jsxs)(i.BT,{children:["Item ID: ",a._id]})]}),!z&&(0,s.jsx)(d.$,{type:"button",variant:"outline",size:"sm",onClick:()=>O(!0),children:"Edit"})]})}),(0,s.jsxs)(i.Wu,{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(x.J,{htmlFor:"description",children:"Description"}),z?(0,s.jsx)(m.T,{id:"description",value:X,onChange:e=>Z(e.target.value),required:!0,minLength:10,maxLength:1e3,className:"mt-1"}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1 whitespace-pre-wrap",children:a.description||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(x.J,{children:"Reporter Email"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:a.reporter_email||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(x.J,{htmlFor:"dateLost",children:"Date Lost"}),z?(0,s.jsx)(u.p,{id:"dateLost",type:"date",value:P,onChange:e=>$(e.target.value),required:!0,className:"mt-1"}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:H(a.date_lost)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(x.J,{htmlFor:"productLink",children:"Product Link"}),z?(0,s.jsx)(u.p,{id:"productLink",type:"url",value:B,onChange:e=>M(e.target.value),placeholder:"Optional: https://...",className:"mt-1"}):a.product_link?(0,s.jsx)("a",{href:a.product_link,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline break-all mt-1 block",children:a.product_link}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(x.J,{children:"Location"}),z?(0,s.jsx)("div",{className:"mt-1 border p-3 rounded-md",children:(0,s.jsx)(h.A,{onLocationChange:V,initialLocation:U})}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:[a.city,a.state,a.country].filter(Boolean).join(", ")||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold text-sm",children:"Images"}),a.image_filenames&&a.image_filenames.length>0?(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 mt-1",children:a.image_filenames.map(e=>(0,s.jsx)("img",{src:"/images/".concat(e),alt:"Lost item",className:"rounded border aspect-square object-cover",onError:e=>e.target.style.display="none"},e))}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"No images uploaded."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(x.J,{children:"Reported On"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:H(a.created_at)})]}),q&&z&&(0,s.jsx)(o.Fc,{variant:"destructive",className:"mt-4",children:(0,s.jsx)(o.TN,{children:q})})]}),(0,s.jsxs)(i.wL,{className:"flex justify-between",children:[z?(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(d.$,{type:"submit",disabled:y,children:[" ",y?"Saving...":"Save Changes"," "]}),(0,s.jsx)(d.$,{type:"button",variant:"outline",onClick:()=>{O(!1),R(null),Z((null==a?void 0:a.description)||""),$((null==a?void 0:a.date_lost)?a.date_lost.substring(0,10):""),M((null==a?void 0:a.product_link)||""),V({country:(null==a?void 0:a.country)||"",state:(null==a?void 0:a.state)||"",city:(null==a?void 0:a.city)||""})},disabled:y,children:"Cancel"})]}):(0,s.jsx)("div",{}),!z&&(0,s.jsxs)(f,{children:[(0,s.jsx)(p,{asChild:!0,children:(0,s.jsx)(d.$,{type:"button",variant:"destructive",disabled:D,children:"Delete Report"})}),(0,s.jsxs)(N,{children:[(0,s.jsxs)(_,{children:[(0,s.jsx)(k,{children:"Are you sure?"}),(0,s.jsx)(w,{children:"This action cannot be undone. This will permanently delete the lost item report and associated images."})]}),(0,s.jsxs)(b,{children:[" ",(0,s.jsx)(L,{children:"Cancel"})," ",(0,s.jsxs)(S,{onClick:G,disabled:D,children:[" ",D?"Deleting...":"Delete"," "]})," "]})]})]})]})]})]})}):(0,s.jsxs)("div",{className:"container mx-auto p-4 max-w-2xl",children:[" ",(0,s.jsxs)(o.Fc,{children:[" ",(0,s.jsx)(o.XL,{children:"Item Not Found"})," ",(0,s.jsx)(o.TN,{children:"The requested item could not be loaded or may have been deleted."})," "]})," "]})}},6591:(e,t,a)=>{"use strict";a.d(t,{Fc:()=>i,TN:()=>c,XL:()=>o});var s=a(7876);a(4232);var l=a(9518),n=a(8488);let r=(0,l.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...l}=e;return(0,s.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,n.cn)(r({variant:a}),t),...l})}function o(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-title",className:(0,n.cn)("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",t),...a})}function c(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-description",className:(0,n.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...a})}}},e=>{var t=t=>e(e.s=t);e.O(0,[987,402,450,288,636,593,792],()=>t(4376)),_N_E=e.O()}]);