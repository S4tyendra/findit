(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[999],{4376:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage/[item_id]",function(){return a(5349)}])},5349:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ee});var s=a(7876),r=a(4232),l=a(9099),n=a(9650),i=a(9081),o=a(6591),d=a(2774),c=a(9983),u=a(3397),m=a(8069),x=a(5627),h=a(7040),g=a(1844),p=a(714),f=a(6303),j=a(3716),v=a(2987),y="AlertDialog",[N,b]=(0,g.A)(y,[f.Hs]),w=(0,f.Hs)(),_=e=>{let{__scopeAlertDialog:t,...a}=e,r=w(t);return(0,s.jsx)(f.bL,{...r,...a,modal:!0})};_.displayName=y;var k=r.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...r}=e,l=w(a);return(0,s.jsx)(f.l9,{...l,...r,ref:t})});k.displayName="AlertDialogTrigger";var D=e=>{let{__scopeAlertDialog:t,...a}=e,r=w(t);return(0,s.jsx)(f.ZL,{...r,...a})};D.displayName="AlertDialogPortal";var S=r.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...r}=e,l=w(a);return(0,s.jsx)(f.hJ,{...l,...r,ref:t})});S.displayName="AlertDialogOverlay";var A="AlertDialogContent",[L,E]=N(A),C=(0,v.Dc)("AlertDialogContent"),R=r.forwardRef((e,t)=>{let{__scopeAlertDialog:a,children:l,...n}=e,i=w(a),o=r.useRef(null),d=(0,p.s)(t,o),c=r.useRef(null);return(0,s.jsx)(f.G$,{contentName:A,titleName:F,docsSlug:"alert-dialog",children:(0,s.jsx)(L,{scope:a,cancelRef:c,children:(0,s.jsxs)(f.UC,{role:"alertdialog",...i,...n,ref:d,onOpenAutoFocus:(0,j.m)(n.onOpenAutoFocus,e=>{e.preventDefault(),c.current?.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[(0,s.jsx)(C,{children:l}),(0,s.jsx)(z,{contentRef:o})]})})})});R.displayName=A;var F="AlertDialogTitle",I=r.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...r}=e,l=w(a);return(0,s.jsx)(f.hE,{...l,...r,ref:t})});I.displayName=F;var T="AlertDialogDescription",O=r.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...r}=e,l=w(a);return(0,s.jsx)(f.VY,{...l,...r,ref:t})});O.displayName=T;var q=r.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...r}=e,l=w(a);return(0,s.jsx)(f.bm,{...l,...r,ref:t})});q.displayName="AlertDialogAction";var $="AlertDialogCancel",J=r.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...r}=e,{cancelRef:l}=E($,a),n=w(a),i=(0,p.s)(t,l);return(0,s.jsx)(f.bm,{...n,...r,ref:i})});J.displayName=$;var z=({contentRef:e})=>{let t=`\`${A}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${A}\` by passing a \`${T}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${A}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return r.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},P=a(8928);function X(e){let{...t}=e;return(0,s.jsx)(_,{"data-slot":"alert-dialog",...t})}function B(e){let{...t}=e;return(0,s.jsx)(k,{"data-slot":"alert-dialog-trigger",...t})}function Z(e){let{...t}=e;return(0,s.jsx)(D,{"data-slot":"alert-dialog-portal",...t})}function Y(e){let{className:t,...a}=e;return(0,s.jsx)(S,{"data-slot":"alert-dialog-overlay",className:(0,P.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function H(e){let{className:t,...a}=e;return(0,s.jsxs)(Z,{children:[(0,s.jsx)(Y,{}),(0,s.jsx)(R,{"data-slot":"alert-dialog-content",className:(0,P.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...a})]})}function M(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-dialog-header",className:(0,P.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function U(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-dialog-footer",className:(0,P.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function V(e){let{className:t,...a}=e;return(0,s.jsx)(I,{"data-slot":"alert-dialog-title",className:(0,P.cn)("text-lg font-semibold",t),...a})}function W(e){let{className:t,...a}=e;return(0,s.jsx)(O,{"data-slot":"alert-dialog-description",className:(0,P.cn)("text-muted-foreground text-sm",t),...a})}function G(e){let{className:t,...a}=e;return(0,s.jsx)(q,{className:(0,P.cn)((0,c.r)(),t),...a})}function K(e){let{className:t,...a}=e;return(0,s.jsx)(J,{className:(0,P.cn)((0,c.r)({variant:"outline"}),t),...a})}let Q="manage_token_",ee=()=>{let e=(0,l.useRouter)(),{item_id:t}=e.query,[a,g]=(0,r.useState)(null),[p,f]=(0,r.useState)(!0),[j,v]=(0,r.useState)(!1),[y,N]=(0,r.useState)(!1),[b,w]=(0,r.useState)(null),[_,k]=(0,r.useState)(null),[D,S]=(0,r.useState)(null),[A,L]=(0,r.useState)(!1),[E,C]=(0,r.useState)(""),[R,F]=(0,r.useState)(""),[I,T]=(0,r.useState)(""),[O,q]=(0,r.useState)({country:"",state:"",city:""}),$=(0,r.useCallback)(async(t,a)=>{f(!0),w(null);try{let s=await (0,n.Yh)(t,a);if(g(s),C(s.description||""),F(s.date_lost?s.date_lost.substring(0,10):""),T(s.product_link||""),q({country:s.country||"",state:s.state||"",city:s.city||""}),e.query.token===a)try{localStorage.setItem("".concat(Q).concat(t),a),console.log("Stored/refreshed management token for item ".concat(t))}catch(e){console.error("Failed to store management token in localStorage:",e)}}catch(s){if(console.error("Error fetching item for management:",s),w(s.message||"Failed to load item details."),g(null),!e.query.token&&a){try{localStorage.removeItem("".concat(Q).concat(t))}catch(e){}w("Invalid or expired token. Please use the link from your email again.")}}finally{f(!1)}},[e.query.token]);(0,r.useEffect)(()=>{if(e.isReady&&t){let a=e.query.token;if(!a)try{a=localStorage.getItem("".concat(Q).concat(t))}catch(e){console.error("Failed to read token from localStorage:",e)}a?(S(a),$(t,a)):(w("Management token is missing."),f(!1))}else!t&&e.isReady&&f(!1)},[e.isReady,t,$]);let J=async e=>{e.preventDefault(),v(!0),k(null);let s={};if(E!==(null==a?void 0:a.description)&&(s.description=E),R!==((null==a?void 0:a.date_lost)?a.date_lost.substring(0,10):""))try{s.date_lost=new Date(R).toISOString()}catch(e){k("Invalid Date Lost format."),v(!1);return}if(I!==((null==a?void 0:a.product_link)||"")&&(s.product_link=I||null),O.country!==((null==a?void 0:a.country)||"")&&(s.country=O.country||null),O.state!==((null==a?void 0:a.state)||"")&&(s.state=O.state||null),O.city!==((null==a?void 0:a.city)||"")&&(s.city=O.city||null),0===Object.keys(s).length){k("No changes detected."),v(!1),L(!1);return}try{let e=await (0,n.fk)(t,D,s);g(e),L(!1)}catch(e){console.error("Update failed:",e),k(e.message||"Failed to save changes.")}finally{v(!1)}},z=async()=>{N(!0),w(null);try{await (0,n.LD)(t,D);try{localStorage.removeItem("".concat(Q).concat(t))}catch(e){}e.push("/?deleted=true")}catch(e){console.error("Delete failed:",e),w(e.message||"Failed to delete item."),N(!1)}},P=e=>{if(!e)return"N/A";try{return new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})}catch(t){return e}};return p?(0,s.jsxs)("div",{className:"container mx-auto p-4 max-w-2xl",children:[" ",(0,s.jsxs)(i.Zp,{children:[" ",(0,s.jsxs)(i.aR,{children:[" ",(0,s.jsx)(d.E,{className:"h-6 w-3/4"})," ",(0,s.jsx)(d.E,{className:"h-4 w-1/2 mt-1"})," "]})," ",(0,s.jsxs)(i.Wu,{className:"space-y-4",children:[" ",(0,s.jsx)(d.E,{className:"h-4 w-full"})," ",(0,s.jsx)(d.E,{className:"h-4 w-full"})," ",(0,s.jsx)(d.E,{className:"h-4 w-2/3"})," ",(0,s.jsx)(d.E,{className:"h-20 w-full"})," "]})," "]})," "]}):b&&!A?(0,s.jsxs)("div",{className:"container mx-auto p-4 max-w-2xl",children:[" ",(0,s.jsxs)(o.Fc,{variant:"destructive",children:[" ",(0,s.jsx)(o.XL,{children:"Error"})," ",(0,s.jsx)(o.TN,{children:b})," "]})," "]}):a?(0,s.jsx)("div",{className:"container mx-auto p-4 max-w-2xl",children:(0,s.jsxs)("form",{onSubmit:J,children:[" ",(0,s.jsxs)(i.Zp,{children:[(0,s.jsx)(i.aR,{children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.ZB,{children:A?"Edit Lost Item":"Manage Lost Item"}),(0,s.jsxs)(i.BT,{children:["Item ID: ",a._id]})]}),!A&&(0,s.jsx)(c.$,{type:"button",variant:"outline",size:"sm",onClick:()=>L(!0),children:"Edit"})]})}),(0,s.jsxs)(i.Wu,{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(x.J,{htmlFor:"description",children:"Description"}),A?(0,s.jsx)(m.T,{id:"description",value:E,onChange:e=>C(e.target.value),required:!0,minLength:10,maxLength:1e3,className:"mt-1"}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1 whitespace-pre-wrap",children:a.description||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(x.J,{children:"Reporter Email"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:a.reporter_email||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(x.J,{htmlFor:"dateLost",children:"Date Lost"}),A?(0,s.jsx)(u.p,{id:"dateLost",type:"date",value:R,onChange:e=>F(e.target.value),required:!0,className:"mt-1"}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:P(a.date_lost)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(x.J,{htmlFor:"productLink",children:"Product Link"}),A?(0,s.jsx)(u.p,{id:"productLink",type:"url",value:I,onChange:e=>T(e.target.value),placeholder:"Optional: https://...",className:"mt-1"}):a.product_link?(0,s.jsx)("a",{href:a.product_link,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline break-all mt-1 block",children:a.product_link}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(x.J,{children:"Location"}),A?(0,s.jsx)("div",{className:"mt-1 border p-3 rounded-md",children:(0,s.jsx)(h.A,{onLocationChange:q,initialLocation:O})}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:[a.city,a.state,a.country].filter(Boolean).join(", ")||"N/A"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold text-sm",children:"Images"}),a.image_filenames&&a.image_filenames.length>0?(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 mt-1",children:a.image_filenames.map(e=>(0,s.jsx)("img",{src:"/images/".concat(e),alt:"Lost item",className:"rounded border aspect-square object-cover",onError:e=>e.target.style.display="none"},e))}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"No images uploaded."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(x.J,{children:"Reported On"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:P(a.created_at)})]}),_&&A&&(0,s.jsx)(o.Fc,{variant:"destructive",className:"mt-4",children:(0,s.jsx)(o.TN,{children:_})})]}),(0,s.jsxs)(i.wL,{className:"flex justify-between",children:[A?(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(c.$,{type:"submit",disabled:j,children:[" ",j?"Saving...":"Save Changes"," "]}),(0,s.jsx)(c.$,{type:"button",variant:"outline",onClick:()=>{L(!1),k(null),C((null==a?void 0:a.description)||""),F((null==a?void 0:a.date_lost)?a.date_lost.substring(0,10):""),T((null==a?void 0:a.product_link)||""),q({country:(null==a?void 0:a.country)||"",state:(null==a?void 0:a.state)||"",city:(null==a?void 0:a.city)||""})},disabled:j,children:"Cancel"})]}):(0,s.jsx)("div",{}),!A&&(0,s.jsxs)(X,{children:[(0,s.jsx)(B,{asChild:!0,children:(0,s.jsx)(c.$,{type:"button",variant:"destructive",disabled:y,children:"Delete Report"})}),(0,s.jsxs)(H,{children:[(0,s.jsxs)(M,{children:[(0,s.jsx)(V,{children:"Are you sure?"}),(0,s.jsx)(W,{children:"This action cannot be undone. This will permanently delete the lost item report and associated images."})]}),(0,s.jsxs)(U,{children:[" ",(0,s.jsx)(K,{children:"Cancel"})," ",(0,s.jsxs)(G,{onClick:z,disabled:y,children:[" ",y?"Deleting...":"Delete"," "]})," "]})]})]})]})]})]})}):(0,s.jsxs)("div",{className:"container mx-auto p-4 max-w-2xl",children:[" ",(0,s.jsxs)(o.Fc,{children:[" ",(0,s.jsx)(o.XL,{children:"Item Not Found"})," ",(0,s.jsx)(o.TN,{children:"The requested item could not be loaded or may have been deleted."})," "]})," "]})}},6591:(e,t,a)=>{"use strict";a.d(t,{Fc:()=>i,TN:()=>d,XL:()=>o});var s=a(7876);a(4232);var r=a(9518),l=a(8928);let n=(0,r.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...r}=e;return(0,s.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,l.cn)(n({variant:a}),t),...r})}function o(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-title",className:(0,l.cn)("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",t),...a})}function d(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-description",className:(0,l.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...a})}}},e=>{var t=t=>e(e.s=t);e.O(0,[789,528,636,593,792],()=>t(4376)),_N_E=e.O()}]);